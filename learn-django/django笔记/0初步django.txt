åˆ›å»ºdjangoå·¥ç¨‹ï¼š
è¿›å…¥å­˜æ”¾ä»£ç çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¾“å…¥
	django-admin startproject mysite
ç„¶åä¼šå¾—åˆ°ä¸€ä¸ª mysite çš„æ–‡ä»¶å¤¹(å·¥ç¨‹å‘½åè¦é¿å…ä¸ç»„ä»¶æˆ–å…³é”®å­—å†²çª)

åˆ›å»ºappï¼š
ï¼ˆåˆ›å»ºä¸€ä¸ªåå­—ä¸ºpollsçš„appï¼‰->  py manage.py startapp polls

åº”ç”¨ä¸‹çš„urls.pyéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š
'''
from django.urls import path

from . import views

urlpatterns = [
    path('', views.index, name='index'),
]
'''

æ•°æ®åº“ç›¸å…³ï¼š
py manage.py migrate æ ¹æ®modelæ‰§è¡ŒSQLè¯­å¥ï¼Ÿï¼ˆä»…å¯¹å·²åœ¨settings.pyä¸­æ³¨å†Œè¿‡çš„appæœ‰æ•ˆï¼‰

å¯åŠ¨appçš„modelä¹‹å‰ è¦å…ˆåœ¨rootä¸‹çš„settings.pyä¸­å®‰è£…app
å³ï¼šåŠ å…¥åˆ° INSTALLED_APPS ä¸­ï¼Œå¦‚ï¼š åŠ å…¥è™šæ‹Ÿè·¯å¾„ 'polls.apps.PollsConfig'
 PollsConfig ç±» ä½äºpolls/apps.py æ–‡ä»¶ä¸­ï¼Œå› æ­¤å…¶è™šçº¿è·¯å¾„ä¸º 'polls.apps.PollsConfig'

è®°å½•pollsåº”ç”¨çš„modelså˜åŒ– ç”Ÿæˆç›¸åº”çš„SQLè¯­å¥ï¼š py manage.py makemigrations polls
å¯å…ˆç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç›¸åº”çš„SQLï¼š
py manage.py sqlmigrate polls 0001 æŸ¥çœ‹0001å˜åŒ–æ•°æ®åº“æ‰€åšçš„äº‹
æœ€ååœ¨è¾“å…¥ï¼špy manage.py migrate ç”Ÿæˆç›¸åº”æ•°æ®è¡¨

Run 'python manage.py makemigrations'   to create migrations for those changes
Run 'python manage.py migrate'		  	to apply those changes to the database


Playing with the APIï¼š
py manage.py shell		åœ¨djangoä¸‹çš„shellç¼–ç¨‹
ä¸‹é¢ä¸ºsqliteæ•°æ®åº“çš„ä¸€äº›æ“ä½œ
'''
>>> from polls.models import Choice, Question  # Import the model classes we just wrote.

# No questions are in the system yet.
>>> Question.objects.all()
<QuerySet []>

# Create a new Question.
# Support for time zones is enabled in the default settings file, so
# Django expects a datetime with tzinfo for pub_date. Use timezone.now()
# instead of datetime.datetime.now() and it will do the right thing.
>>> from django.utils import timezone
>>> q = Question(question_text="What's new?", pub_date=timezone.now())

# Save the object into the database. You have to call save() explicitly.
>>> q.save()

# Now it has an ID.
>>> q.id
1

# Access model field values via Python attributes.
>>> q.question_text
"What's new?"
>>> q.pub_date
datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=<UTC>)

# Change values by changing the attributes, then calling save().
>>> q.question_text = "What's up?"
>>> q.save()

# objects.all() displays all the questions in the database.
>>> Question.objects.all()
<QuerySet [<Question: Question object (1)>]>
'''

å…¶ä»–ORMæ“ä½œï¼š
>>> Question.objects.filter(id=1)
<QuerySet [<Question: What's up?>]>

>>> Question.objects.filter(question_text__startswith='What')
<QuerySet [<Question: What's up?>]>

# Get the question that was published this year.
>>> from django.utils import timezone
>>> current_year = timezone.now().year
>>> Question.objects.get(pub_date__year=current_year)		åŒä¸‹åˆ’çº¿ç›¸å½“äº . ğŸï¼Ÿ
<Question: What's up?>

è‹¥æ²¡æœ‰ç¬¦åˆgetå‡½æ•°ä¸­çš„æ¡ä»¶ ä¼šæŠ›å‡ºå¼‚å¸¸


é€šè¿‡å¤–é”®åˆ›å»ºæ•°æ®å…ƒç»„ï¼š
'''
>>> q = Question.objects.get(pk=1)

# Display any choices from the related object set -- none so far.
>>> q.choice_set.all()
<QuerySet []>

# Create three choices.
>>> q.choice_set.create(choice_text='Not much', votes=0)
<Choice: Not much>
>>> q.choice_set.create(choice_text='The sky', votes=0)
<Choice: The sky>
>>> c = q.choice_set.create(choice_text='Just hacking again', votes=0)

# Choice objects have API access to their related Question objects.
>>> c.question
<Question: What's up?>

# And vice versa: Question objects get access to Choice objects.
>>> q.choice_set.all()
<QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]>
>>> q.choice_set.count()
3
'''


djangoè‡ªå¸¦çš„ç®¡ç†å‘˜ç•Œé¢ï¼š
éœ€è¦å…ˆç”¨manage.pyåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·	py manage.py createsuperuser
ç„¶åè®¿é—® http://127.0.0.1:8000/admin/
è¿˜éœ€è¦åœ¨å¯¹åº”çš„appä¸­æ³¨å†Œæ¨¡å‹ 

ä¾‹å¦‚ï¼š	åœ¨polls/admin.pyæ³¨å†ŒQuestionæ¨¡å‹
'''
from django.contrib import admin

from .models import Question

admin.site.register(Question)
'''

è§†å›¾å‡½æ•°ï¼š
1.åº”ç”¨ä¸­çš„ views.py ä¸­ç¼–å†™è§†å›¾å‡½æ•°ï¼Œéœ€è¦çš„å‚æ•°ä¹Ÿè¦å†™åœ¨è§†å›¾å‡½æ•°çš„å‚æ•°ä¸­
2.éœ€è¦åœ¨åº”ç”¨ä¸­çš„ urls.py è¿›è¡Œé…ç½®
ä¾‹å¦‚ï¼š
'''
from django.urls import path

from . import views

urlpatterns = [
    # ex: /polls/
    path('', views.index, name='index'),
    # ex: /polls/5/
    path('<int:question_id>/', views.detail, name='detail'),
    # ex: /polls/5/results/
    path('<int:question_id>/results/', views.results, name='results'),
    # ex: /polls/5/vote/
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
'''

éœ€è¦ç»“åˆhtmlè¿”å›æ—¶ï¼Œè¦åœ¨åº”ç”¨ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹templateï¼ˆåœ¨åº”ç”¨ä¸­ä½¿ç”¨ç›¸å¯¹äºè¯¥templateçš„ç›¸å¯¹è·¯å¾„ï¼‰
åªæœ‰ä¸€ä¸ªåº”ç”¨å¯¹åº”ä¸€ä¸ªtemplate æ‰èƒ½åšåˆ°æŠŠåº”ç”¨å½“ä½œdjangoé¡¹ç›®çš„æ’ä»¶


ä½¿ç”¨ä»¥ä¸‹å†™æ³•å¯ä»¥çœç•¥ try-catch è¯­å¥å—æ•æŠ“æŸ¥è¯¢ä¸ºç©ºçš„å¼‚å¸¸
question = get_object_or_404(Question, pk=question_id)


ç§»é™¤templateä¸­çš„ç¡¬ç¼–ç ï¼š
å°†ç¡¬ç¼–ç æ¢æˆä»¥ä¸‹ä½¿ç”¨urlæ ‡ç­¾çš„ç¼–ç æ–¹å¼
'detail' æ˜¯å› ä¸ºåœ¨åº”ç”¨çš„ urls.py ä¸­ name='detail' ï¼ˆç›¸å½“äºç»™è§†å›¾å‡½æ•°èµ·åäº†ï¼Ÿï¼‰
è¦æ”¹urlæ—¶ åªéœ€è¦åœ¨urls.pyä¸­ä¿®æ”¹å³å¯
'''
<li><a href="{% url 'detail' question.id %}">{{ question.question_text }}</a></li>
'''
åœ¨ 'detial' ååŠ ä¸Šå‚æ•°å°±è¡Œ

ä½†æ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­çš„å¤šä¸ªåº”ç”¨é‡Œ nameå¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥éœ€è¦ç»™åº”ç”¨åŠ ä¸Šå‘½åç©ºé—´ app_name
ex: åœ¨polls/urls.pyä¸­
åŠ ä¸Š app_name = 'polls'

ex:æ¨¡æ¿index.htmlä¸­éœ€è¦ä¿®æ”¹ä¸º
'''
<li><a href="{% url 'polls:detail' question.id %}">{{ question.question_text }}</a></li>
'''


è¡¨å•çš„æäº¤ï¼š
æ¯ä¸ªè¡¨å• <form> éƒ½éœ€è¦åœ¨<form></form>ä¸ŠåŠ  {% csrf_token %} æ¥é˜²æ­¢è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ (Cross Site Request Forgeries) -> csrf

é€šè¿‡ reques.POST['åå­—(å³name)'] è·å¾—è¡¨å•å…ƒç´ çš„valueï¼ˆç±»å‹ä¸ºstrï¼‰é€šè¿‡è¯¥æ–¹å¼è·å–å¯èƒ½ä¼šæŠ›å‡ºKeyErrorå¼‚å¸¸

HttpResponseRedirect æ˜¯é‡å®šå‘è¯·æ±‚ï¼ˆdjangoçš„ç«™å†…è·³è½¬è¯·æ±‚æ˜¯ï¼Ÿï¼‰
åœ¨æˆåŠŸå¤„ç†formçš„æ•°æ®å æˆ‘ä»¬æ€»æ˜¯åº”è¯¥è¿”å›ä¸€ä¸ª HttpResponseRedirect é‡å®šå‘
åœ¨ HttpResponseRedirect ä¸­ ä½¿ç”¨ reverse() å‡½æ•°æ„é€ urlé¿å…ç¡¬ç¼–ç 
ex:
return HttpResponseRedirect(reverse('polls:results', args=(question_id,)) )
å…¶ä¸­ï¼š
	resultsè§†å›¾å‡½æ•°éœ€è¦ä¸€ä¸ª question_id ä½œä¸ºå‚æ•°
	reverseå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² 	å¦‚ï¼š'/polls/3/results/'


ä½¿ç”¨generic viewsï¼š
ï¼ˆåŸç†ä¸æ‡‚å•Š... æ˜¯ä¼šè‡ªåŠ¨é€šè¿‡pkæŸ¥è¯¢æ•°æ®å—ï¼Ÿ TODO ï¼‰
éœ€è¦åœ¨urls.pyä¸­ä½¿ç”¨
exï¼š	
	path('', views.IndexView.as_view(), name='index'),
	# NOTE: question_id æ”¹ä¸ºäº† pk  DetailViewæœŸæœ›è·å¾—ä¸€ä¸ªpkï¼ˆä¼šè‡ªåŠ¨é€šè¿‡pkæŸ¥æ‰¾ç›¸åº”çš„æ•°æ®ï¼Ÿï¼‰
	path('<int:pk>/', views.DetailView.as_view(), name='detail'),
	path('<int:pk>/results/', views.ResultsView.as_view(), name='results'),

é»˜è®¤æƒ…å†µä¸‹ï¼ŒDetialView è¿™ä¸ª generic view ä¼šè¿”å› template_name ä¸º <app name>/<model name>_detail.html
exï¼š	'polls/question_detial.html'
å¯ä»¥é€šè¿‡å†™ template_name æ¥æŒ‡å®šè¿”å›htmlçš„è·¯å¾„

å¯¹äº ListViewï¼šè‡ªåŠ¨ç”Ÿæˆçš„ context å˜é‡æ˜¯ question_list
ä¸ºäº†è¦†ç›–è¿™ä¸ªè¡Œä¸ºï¼Œæˆ‘ä»¬æä¾› context_object_name å±æ€§ï¼Œè¡¨ç¤ºæˆ‘ä»¬æƒ³ä½¿ç”¨ latest_question_list
exï¼šcontext_object_name = 'latest_question_list'
IndexViewéœ€è¦ä¸€ä¸ªå‡½æ•°è¿”å›indexæ˜¾ç¤ºçš„å†…å®¹  def get_queryset(self):... è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆé›†åˆï¼Ÿï¼‰åŒ…å«æ˜¾ç¤ºå†…å®¹


è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š
åœ¨åº”ç”¨ä¸­çš„ tests.py å†™ç»§æ‰¿äº django.test.TestCase çš„ç±» ï¼Œç±»ä¸­å†™æµ‹è¯•å‡½æ•°
å‡½æ•°ä¸­æœ€åä¸ºè¯­å¥ exï¼š  self.assertIs(future_question.was_published_recently(), False)
ç„¶åè¿è¡Œ	py manage.py test polls æŸ¥çœ‹æµ‹è¯•ç»“æœï¼ˆè¿™é‡Œçš„polls ä¼šä½¿manage.pyå»å¯»æ‰¾pollsçš„æµ‹è¯•ä»£ç ï¼‰

å†™æµ‹è¯•ä»£ç æ—¶çš„å»ºè®®ï¼š
	1.å¯¹äºæ¯ä¸ªæ¨¡å‹å’Œè§†å›¾éƒ½å»ºç«‹å•ç‹¬çš„ TestClass
	2.æ¯ä¸ªæµ‹è¯•æ–¹æ³•åªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½
	3.ç»™æ¯ä¸ªæµ‹è¯•æ–¹æ³•èµ·ä¸ªèƒ½æè¿°å…¶åŠŸèƒ½çš„åå­—


é™æ€æ–‡ä»¶çš„å¤„ç†ï¼ˆå¦‚ï¼šcssï¼‰ï¼š
éœ€è¦åœ¨åº”ç”¨ç›®å½•ä¸‹åˆ›å»º static æ–‡ä»¶å¤¹ï¼Œåœ¨staticä¸‹å†åˆ›å»º polls(appå) æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾css

åœ¨ä½¿ç”¨cssçš„æ¨¡æ¿ä¸Šå†™ï¼š
	{% load static %}
	<link rel="stylesheet" type="text/css" href="{% static 'polls/style.css' %}">

	å…¶ä¸­ï¼š
		{% static %} æ¨¡æ¿æ ‡ç­¾ä¼šç”Ÿæˆé™æ€æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

è€Œå›¾ç‰‡æ–‡ä»¶åˆ™éœ€è¦åœ¨ static/polls ä¸‹å†åˆ›å»º images æ–‡ä»¶å¤¹